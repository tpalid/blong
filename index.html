<!DOCTYPE html>
<!-- HTML5 Hello world by kirupa - http://www.kirupa.com/html5/getting_your_feet_wet_html5_pg1.htm -->
<html lang="en-us">

<head>
<meta charset="utf-8">
<title>Blong!</title>
<style type="text/css">
#board {
	background-color: black;
}
</style>
</head>

<body>

<canvas id="board" width="1000" height="700"></a>></canvas>

<script> 

function draw_box() {
	var table_canvas = document.getElementById("board");
	var table_context = table_canvas.getContext("2d");
	return table_context;
}; 

var table_context = draw_box();

function Paddle(x, y, width, height, speed) {
    this.x = x;
    this.y = y;
    this.width = width;
    this.height = height;
    this.speed = speed; //pixels per key press
    this.render = function() {
        table_context.beginPath();
    	table_context.rect(this.x, this.y, this.width, this.height);
		table_context.fillStyle = "red";
		table_context.fill();
		table_context.closePath();
    };
    this.move = function(speed) {
        if ((this.y += speed) < 0) {
            this.y = 0;
        }
        else if ((this.y += speed) > 600){
            this.y = 600;
        }
        else this.y = this.y + speed;
    };
}

function Ball(x, y, radius, speedx, speedy){
	this.x = x;
    this.y = y;
    this.radius = radius;
    this.speedx = speedx;
    this.speedy = speedy;
    this.render = function(rect) {
        table_context.beginPath();
    	table_context.arc(this.x, this.y, this.radius, 0, 2*Math.PI);
		table_context.fillStyle = "red";
		table_context.fill();
		table_context.closePath();
		this.move(rect);
    };
    this.move = function() {
        if ((this.y - this.radius) == 0 || (this.y + this.radius) == 700) {
            console.log("bounce");
            this.speedy = - this.speedy;
            }
        else if ((hit(player) == true) || (hit(computer) == true)) {
            console.log("bounce");
            this.speedx = - this.speedx;
            }
        this.y = this.y + this.speedy;
        this.x = this.x + this.speedx;
    };
 }
 
function hit(paddle) {
    var distX = Math.abs(ball.x - paddle.x - paddle.width/2);
    var distY = Math.abs(ball.y - paddle.y - paddle.height/2);
    if (distX > (paddle.width / 2 + ball.radius)) {
    return false;
    }
    if (distY > (paddle.height / 2 + ball.radius)) {
    return false;
    }
    if (distX <= (paddle.width / 2)) {
        return true;
    }
    if (distY <= (paddle.height / 2)) {
        return true;
    }

}


var player = new Paddle(980, 250, 20, 100, 10); //10 pixels per key press
var computer = new Paddle(0, 300, 20, 100);
var ball = new Ball(500, 340, 20, -2, -2); //initial speed 5 pixels per second

function render() {
table_context.clearRect(0, 0, 1000, 700);
player.render();
computer.render();
ball.render();
}

var animate = window.requestAnimationFrame ||
    function(callback) { window.setTimeout(callback, 100/60) };
    
function step() {   
    render();
    animate(step);
}

window.addEventListener('keydown', function(event) {
    if (event.keyCode == 38) {
        player.move(-player.speed);
    }
    else if (event.keyCode == 40) {
        player.move(player.speed);
    }
}); 

window.onload = function(){
    step();
};

</script>

</body>
</html>
